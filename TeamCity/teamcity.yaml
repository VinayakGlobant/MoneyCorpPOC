version: "2023.10"
project:
  name: "Dashboard-CI"

parameters:
  TARGET_SUBSCRIPTION_ID: "2e2c8853-dd2c-4e45-89b9-073ee228cfbf"  # can be set in TeamCity UI
  TARGET_RG: "rg-dashboards-prod"
  APP_INSIGHTS_NAME: "test-fapp-mcorp"

steps:
  - name: "Checkout repository"
    checkout: true

  - name: "Validate JSON"
    script:
      - bash scripts/validate-json.sh

  - name: "Replace placeholders"
    script:
      - bash scripts/replace-placeholders.sh "azure-dashboards/notification-api/dashboard.json" "azure-dashboards/notification-api/dashboard-final.json"

  - name: "Package artifact"
    script:
      - zip -r dashboard-artifact.zip dashboards terraform

artifacts:
  paths:
    - dashboard-artifact.zip
